{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_list %}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block extrahead %}
{{ block.super }}
<!-- Polyfill para interpolate/gettext - Cloudflare Rocket Loader quebra a ordem dos scripts Django -->
<script data-cfasync="false">
if(typeof interpolate==='undefined'){window.interpolate=function(fmt,obj,named){if(named){return fmt.replace(/%\(\w+\)s/g,function(m){return String(obj[m.slice(2,-2)])})}else{var i=0;return fmt.replace(/%s/g,function(){return String(obj[i++])})}}}
if(typeof gettext==='undefined'){window.gettext=function(s){return s}}
if(typeof ngettext==='undefined'){window.ngettext=function(s,p,n){return n===1?s:p}}
if(typeof pgettext==='undefined'){window.pgettext=function(ctx,s){return s}}
</script>
{{ form.media }}
<style>
    /* ===== Layout Principal ===== */
    .notification-panel {
        display: grid;
        grid-template-columns: 1fr 380px;
        gap: 28px;
        align-items: start;
    }
    @media (max-width: 960px) {
        .notification-panel { grid-template-columns: 1fr; }
        .phone-preview { order: -1; }
    }

    /* ===== Stats Cards ===== */
    .stats-row {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 14px;
        margin-bottom: 24px;
    }
    @media (max-width: 700px) {
        .stats-row { grid-template-columns: repeat(2, 1fr); }
    }
    .stat-card {
        color: white;
        padding: 18px 14px;
        border-radius: 14px;
        text-align: center;
        position: relative;
        overflow: hidden;
        transition: transform 0.2s, box-shadow 0.2s;
    }
    .stat-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.2);
    }
    .stat-card::after {
        content: '';
        position: absolute;
        top: -50%;
        right: -30%;
        width: 100px;
        height: 100px;
        background: rgba(255,255,255,0.08);
        border-radius: 50%;
    }
    .stat-card.purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .stat-card.green  { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
    .stat-card.orange { background: linear-gradient(135deg, #f7971e 0%, #ffd200 100%); }
    .stat-card.red    { background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%); }
    .stat-number { font-size: 32px; font-weight: 800; display: block; line-height: 1; margin-bottom: 4px; }
    .stat-label { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; opacity: 0.9; font-weight: 600; }

    /* ===== Fieldsets melhorados ===== */
    fieldset.module {
        border: 1px solid var(--hairline-color, #ddd);
        border-radius: 12px;
        overflow: hidden;
        margin-bottom: 16px;
    }
    fieldset.module h2 {
        background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
        color: #fff;
        padding: 12px 18px;
        font-size: 14px;
        letter-spacing: 0.3px;
        margin: 0;
    }
    fieldset.module .form-row {
        padding: 10px 18px;
        border-bottom: 1px solid var(--hairline-color, #eee);
    }
    fieldset.module .form-row:last-child { border-bottom: none; }

    /* ===== Inputs ===== */
    #content input[type="text"],
    #content input[type="url"],
    #content select,
    #content textarea {
        width: 100%;
        padding: 10px 14px;
        border: 2px solid var(--border-color, #ddd);
        border-radius: 8px;
        font-size: 14px;
        transition: border-color 0.2s, box-shadow 0.2s;
        box-sizing: border-box;
        background: var(--body-bg, #fff);
        color: var(--body-fg, #333);
    }
    #content input[type="text"]:focus,
    #content input[type="url"]:focus,
    #content select:focus,
    #content textarea:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102,126,234,0.15);
        outline: none;
    }

    /* ===== Phone Preview ===== */
    .phone-preview { position: sticky; top: 80px; }
    .phone-preview-title {
        text-align: center;
        color: var(--body-quiet-color, #666);
        margin-bottom: 12px;
        font-size: 14px;
        font-weight: 600;
    }
    .phone-frame {
        background: linear-gradient(145deg, #0f0f1a 0%, #1a1a2e 50%, #0f0f1a 100%);
        border-radius: 36px;
        padding: 12px;
        box-shadow: 0 25px 60px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.05);
        max-width: 340px;
        margin: 0 auto;
        border: 2px solid #2a2a3e;
    }
    .phone-notch {
        width: 120px;
        height: 28px;
        background: #0f0f1a;
        border-radius: 0 0 18px 18px;
        margin: 0 auto 12px;
        position: relative;
    }
    .phone-notch::after {
        content: '';
        width: 10px;
        height: 10px;
        background: #1e1e3a;
        border-radius: 50%;
        position: absolute;
        right: 25px;
        top: 8px;
        box-shadow: inset 0 0 3px rgba(102,126,234,0.5);
    }
    .phone-screen {
        background: linear-gradient(180deg, #0e1628 0%, #162447 100%);
        border-radius: 24px;
        overflow: hidden;
        padding: 0 14px 20px;
        min-height: 280px;
    }
    .phone-statusbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: #fff;
        font-size: 12px;
        padding: 10px 4px 16px;
        font-weight: 500;
    }
    .phone-statusbar-icons { display: flex; gap: 4px; align-items: center; }
    .phone-statusbar-icons span { font-size: 10px; }
    .notif-card {
        background: rgba(255,255,255,0.97);
        border-radius: 16px;
        padding: 14px 16px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        animation: notifSlide 0.4s cubic-bezier(.175,.885,.32,1.275);
    }
    @keyframes notifSlide {
        from { transform: translateY(-15px) scale(0.96); opacity: 0; }
        to { transform: translateY(0) scale(1); opacity: 1; }
    }
    .notif-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 10px;
    }
    .notif-icon {
        width: 38px;
        height: 38px;
        border-radius: 10px;
        object-fit: cover;
        flex-shrink: 0;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .notif-app-name { font-size: 13px; color: #555; font-weight: 700; }
    .notif-time { font-size: 11px; color: #aaa; margin-left: auto; font-weight: 500; }
    .notif-title {
        font-weight: 800;
        font-size: 14px;
        color: #111;
        margin-bottom: 5px;
        word-break: break-word;
        line-height: 1.3;
    }
    .notif-body {
        font-size: 13px;
        color: #555;
        line-height: 1.5;
        word-break: break-word;
    }
    .phone-icon-badge {
        text-align: center;
        margin-top: 35px;
        opacity: 0.35;
        transition: opacity 0.3s;
    }
    .phone-icon-badge:hover { opacity: 0.6; }
    .phone-icon-badge img {
        width: 48px;
        border-radius: 14px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }
    .phone-icon-badge p {
        color: #8892b0;
        font-size: 10px;
        margin-top: 6px;
        letter-spacing: 0.5px;
    }

    /* ===== Templates R√°pidos ===== */
    .templates-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        padding: 14px 18px;
    }
    .template-btn {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 8px 16px;
        border: 2px solid var(--border-color, #ddd);
        border-radius: 24px;
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
        background: var(--body-bg, #fff);
        color: var(--body-fg, #333);
        transition: all 0.25s;
        user-select: none;
    }
    .template-btn:hover {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: #fff;
        border-color: #667eea;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102,126,234,0.3);
    }
    .template-btn:active { transform: translateY(0); }

    /* ===== Emoji Bar ===== */
    .emoji-bar {
        display: flex;
        gap: 6px;
        flex-wrap: wrap;
        margin: 8px 0;
    }
    .emoji-btn {
        font-size: 22px;
        cursor: pointer;
        border: 2px solid transparent;
        border-radius: 10px;
        padding: 5px 8px;
        background: var(--darkened-bg, #f5f5f5);
        transition: all 0.2s;
        line-height: 1;
        user-select: none;
    }
    .emoji-btn:hover {
        border-color: #667eea;
        transform: scale(1.2) translateY(-2px);
        background: rgba(102,126,234,0.1);
        box-shadow: 0 4px 10px rgba(102,126,234,0.2);
    }
    .emoji-btn:active { transform: scale(0.95); }

    /* ===== Info boxes ===== */
    .destinatarios-info {
        background: linear-gradient(135deg, rgba(255,243,205,0.8), rgba(255,234,167,0.5));
        border: 1px solid #ffeaa7;
        padding: 12px 16px;
        border-radius: 10px;
        margin: 12px 0;
        font-size: 13px;
    }
    .error-box {
        background: linear-gradient(135deg, rgba(255,224,224,0.9), rgba(255,200,200,0.7));
        border: 1px solid #fc8181;
        padding: 14px 18px;
        border-radius: 10px;
        margin-bottom: 16px;
        color: #c53030;
        font-weight: 500;
    }

    /* ===== Bot√£o Enviar ===== */
    .submit-row {
        padding: 16px 0 !important;
        display: flex;
        align-items: center;
        gap: 12px;
    }
    .submit-row input[type="submit"].default {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        color: #fff;
        font-size: 15px;
        font-weight: 700;
        padding: 12px 36px;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 4px 15px rgba(102,126,234,0.3);
        letter-spacing: 0.3px;
    }
    .submit-row input[type="submit"].default:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 25px rgba(102,126,234,0.45);
    }
    .submit-row a {
        color: var(--body-quiet-color, #666);
        text-decoration: none;
        padding: 12px 20px;
        border-radius: 10px;
        font-size: 13px;
        transition: background 0.2s;
    }
    .submit-row a:hover { background: var(--darkened-bg, #eee); }

    /* ===== T√≠tulo Contador ===== */
    .char-counter {
        font-size: 12px;
        color: var(--body-quiet-color, #888);
        margin-top: 4px;
    }
    .char-counter strong { transition: color 0.2s; }
    .char-counter.warn strong { color: #f39c12; }
    .char-counter.danger strong { color: #e74c3c; font-size: 13px; }

    /* ===== Page title ===== */
    .page-title {
        font-size: 22px;
        font-weight: 800;
        margin-bottom: 4px;
        color: var(--body-fg, #333);
    }
    .page-subtitle {
        font-size: 14px;
        color: var(--body-quiet-color, #666);
        margin-bottom: 20px;
    }

    /* ===== Checkbox styled ===== */
    #content input[type="checkbox"] {
        width: 18px;
        height: 18px;
        accent-color: #667eea;
        vertical-align: middle;
        margin-right: 6px;
    }

    /* ===== Smooth transitions globais ===== */
    *, *::before, *::after { box-sizing: border-box; }
</style>
{% endblock %}

{% block content %}
<div class="content-main">
    <!-- Stats -->
    <div class="stats-row">
        <div class="stat-card purple">
            <span class="stat-number">{{ total_participantes }}</span>
            <span class="stat-label">Total Participantes</span>
        </div>
        <div class="stat-card green">
            <span class="stat-number">{{ com_notifs_ativadas }}</span>
            <span class="stat-label">Notifs Ativadas</span>
        </div>
        <div class="stat-card orange">
            <span class="stat-number">{{ com_push_subscription }}</span>
            <span class="stat-label">Com Push</span>
        </div>
        <div class="stat-card red">
            <span class="stat-number">{{ notifs_enviadas_hoje }}</span>
            <span class="stat-label">Enviadas Hoje</span>
        </div>
    </div>

    <form method="post" novalidate>
        {% csrf_token %}
        
        <div class="notification-panel">
            <!-- Coluna esquerda: formul√°rio -->
            <div>
                <h1 class="page-title">{{ title }}</h1>
                
                {% if subtitle %}
                <p class="page-subtitle">{{ subtitle }}</p>
                {% endif %}
                
                {% if participantes_count > 0 %}
                <div class="destinatarios-info">
                    <strong>üìã Participantes pr√©-selecionados:</strong> {{ participantes_count }}
                </div>
                {% endif %}
                
                {% if form.errors %}
                <div class="error-box">
                    <strong>‚ö†Ô∏è Corrija os erros abaixo:</strong>
                    {{ form.non_field_errors }}
                </div>
                {% endif %}

                <!-- Templates r√°pidos -->
                <fieldset class="module">
                    <h2>‚ö° Templates R√°pidos</h2>
                    <div class="templates-grid">
                        <div class="template-btn" onclick="applyTemplate('rodada')">üÜï Nova Rodada</div>
                        <div class="template-btn" onclick="applyTemplate('lembrete')">‚è∞ Lembrete Prazo</div>
                        <div class="template-btn" onclick="applyTemplate('resultados')">üìä Resultados</div>
                        <div class="template-btn" onclick="applyTemplate('ranking')">üèÜ Ranking</div>
                        <div class="template-btn" onclick="applyTemplate('anuncio')">üì¢ An√∫ncio Geral</div>
                        <div class="template-btn" onclick="applyTemplate('manutencao')">üîß Manuten√ß√£o</div>
                    </div>
                </fieldset>

                <fieldset class="module aligned">
                    <h2>üìù Conte√∫do da Notifica√ß√£o</h2>
                    
                    <div class="form-row">
                        <div>
                            <label for="{{ form.tipo.id_for_label }}" class="required">Tipo:</label>
                            {{ form.tipo }}
                        </div>
                    </div>

                    <div class="form-row">
                        <div>
                            <label for="{{ form.titulo.id_for_label }}" class="required">T√≠tulo:</label>
                            {{ form.titulo }}
                            <p class="char-counter" id="titulo-counter">M√°x 100 caracteres. <strong id="titulo-count">0</strong>/100</p>
                            {% for error in form.titulo.errors %}<ul class="errorlist"><li>{{ error }}</li></ul>{% endfor %}
                        </div>
                    </div>

                    <!-- Emojis r√°pidos -->
                    <div class="form-row">
                        <div>
                            <label>Emojis r√°pidos:</label>
                            <div class="emoji-bar">
                                <span class="emoji-btn" onclick="insertEmoji('‚öΩ')">‚öΩ</span>
                                <span class="emoji-btn" onclick="insertEmoji('üèÜ')">üèÜ</span>
                                <span class="emoji-btn" onclick="insertEmoji('üéØ')">üéØ</span>
                                <span class="emoji-btn" onclick="insertEmoji('üî•')">üî•</span>
                                <span class="emoji-btn" onclick="insertEmoji('üéâ')">üéâ</span>
                                <span class="emoji-btn" onclick="insertEmoji('üìä')">üìä</span>
                                <span class="emoji-btn" onclick="insertEmoji('‚è∞')">‚è∞</span>
                                <span class="emoji-btn" onclick="insertEmoji('üöÄ')">üöÄ</span>
                                <span class="emoji-btn" onclick="insertEmoji('üì¢')">üì¢</span>
                                <span class="emoji-btn" onclick="insertEmoji('üí™')">üí™</span>
                                <span class="emoji-btn" onclick="insertEmoji('‚≠ê')">‚≠ê</span>
                                <span class="emoji-btn" onclick="insertEmoji('ü•á')">ü•á</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div>
                            <label for="{{ form.mensagem.id_for_label }}" class="required">Mensagem:</label>
                            {{ form.mensagem }}
                            {% for error in form.mensagem.errors %}<ul class="errorlist"><li>{{ error }}</li></ul>{% endfor %}
                        </div>
                    </div>

                    <div class="form-row">
                        <div>
                            <label for="{{ form.url_acao.id_for_label }}">URL de A√ß√£o:</label>
                            {{ form.url_acao }}
                            <p class="help">{{ form.url_acao.help_text }}</p>
                        </div>
                    </div>
                </fieldset>

                <fieldset class="module aligned">
                    <h2>üéØ Destinat√°rios</h2>
                    
                    <div class="form-row">
                        <div>
                            <label for="{{ form.destinatarios.id_for_label }}" class="required">Para quem enviar:</label>
                            {{ form.destinatarios }}
                            <p class="help" id="destinatarios-desc"></p>
                        </div>
                    </div>

                    <div class="form-row" id="participantes_especificos" style="display: none;">
                        <div>
                            <label for="{{ form.participantes_selecionados.id_for_label }}">Participantes:</label>
                            {{ form.participantes_selecionados }}
                        </div>
                    </div>
                </fieldset>

                <fieldset class="module aligned">
                    <h2>‚öôÔ∏è Op√ß√µes</h2>
                    
                    <div class="form-row">
                        <div>
                            <label for="{{ form.rodada_relacionada.id_for_label }}">Rodada Relacionada:</label>
                            {{ form.rodada_relacionada }}
                        </div>
                    </div>

                    <div class="form-row">
                        <div>
                            {{ form.enviar_imediatamente }}
                            <label for="{{ form.enviar_imediatamente.id_for_label }}" style="display: inline;">
                                {{ form.enviar_imediatamente.label }}
                            </label>
                            <p class="help">{{ form.enviar_imediatamente.help_text }}</p>
                        </div>
                    </div>
                </fieldset>

                <div class="submit-row">
                    <input type="submit" value="üöÄ Enviar Notifica√ß√£o" class="default" />
                    <a href="/admin/bolao/notification/">Cancelar</a>
                </div>
            </div>

            <!-- Coluna direita: preview estilo celular -->
            <div class="phone-preview">
                <p class="phone-preview-title">üì± Preview da Notifica√ß√£o</p>
                <div class="phone-frame">
                    <div class="phone-notch"></div>
                    <div class="phone-screen">
                        <div class="phone-statusbar">
                            <span>9:41</span>
                            <span style="font-weight:700;">FutAmigo</span>
                            <div class="phone-statusbar-icons">
                                <span>üì∂</span>
                                <span>üîã</span>
                            </div>
                        </div>
                        
                        <div class="notif-card" id="notif-preview">
                            <div class="notif-header">
                                <img src="{% static 'futfavi.webp' %}" alt="FutAmigo" class="notif-icon">
                                <div>
                                    <div class="notif-app-name">FutAmigo</div>
                                </div>
                                <div class="notif-time">agora</div>
                            </div>
                            <div class="notif-title" id="preview-title">‚öΩ T√≠tulo da notifica√ß√£o</div>
                            <div class="notif-body" id="preview-body">Mensagem da notifica√ß√£o aparecer√° aqui...</div>
                        </div>

                        <div class="phone-icon-badge">
                            <img src="{% static 'futfavi.webp' %}" alt="">
                            <p>√çcone usado nas notifica√ß√µes</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<script data-cfasync="false">
document.addEventListener('DOMContentLoaded', function() {
    const tituloInput = document.getElementById('{{ form.titulo.id_for_label }}');
    const mensagemInput = document.getElementById('{{ form.mensagem.id_for_label }}');
    const previewTitle = document.getElementById('preview-title');
    const previewBody = document.getElementById('preview-body');
    const tituloCount = document.getElementById('titulo-count');
    const tituloCounter = document.getElementById('titulo-counter');
    const destinatariosSelect = document.getElementById('{{ form.destinatarios.id_for_label }}');
    const participantesDiv = document.getElementById('participantes_especificos');
    const destinatariosDesc = document.getElementById('destinatarios-desc');

    const descMap = {
        'todos': 'üì£ Envia para TODOS os {{ total_participantes }} participantes',
        'ativos': '‚úÖ Apenas participantes ativos',
        'com_notifs': 'üîî {{ com_notifs_ativadas }} participantes com notifica√ß√µes ativadas',
        'selecionados': 'üë• Escolha participantes espec√≠ficos abaixo'
    };

    function updatePreview() {
        const title = tituloInput.value;
        const body = mensagemInput.value;
        previewTitle.textContent = title || '‚öΩ T√≠tulo da notifica√ß√£o';
        previewBody.textContent = body || 'Mensagem da notifica√ß√£o aparecer√° aqui...';
        
        // Counter com classes de alerta
        const len = title.length;
        tituloCount.textContent = len;
        tituloCounter.className = 'char-counter' + (len > 90 ? ' danger' : len > 70 ? ' warn' : '');
        
        // Animate preview card on change
        const card = document.getElementById('notif-preview');
        card.style.animation = 'none';
        void card.offsetHeight;
        card.style.animation = 'notifSlide 0.3s ease';
    }

    tituloInput.addEventListener('input', updatePreview);
    mensagemInput.addEventListener('input', updatePreview);

    function toggleParticipantes() {
        const val = destinatariosSelect.value;
        participantesDiv.style.display = val === 'selecionados' ? 'block' : 'none';
        destinatariosDesc.textContent = descMap[val] || '';
    }

    destinatariosSelect.addEventListener('change', toggleParticipantes);
    toggleParticipantes();
    updatePreview();
});

// Inserir emoji
let lastFocusedInput = null;
document.getElementById('{{ form.titulo.id_for_label }}').addEventListener('focus', function() { lastFocusedInput = this; });
document.getElementById('{{ form.mensagem.id_for_label }}').addEventListener('focus', function() { lastFocusedInput = this; });

function insertEmoji(emoji) {
    const input = lastFocusedInput || document.getElementById('{{ form.titulo.id_for_label }}');
    const start = input.selectionStart;
    const end = input.selectionEnd;
    input.value = input.value.substring(0, start) + emoji + input.value.substring(end);
    input.selectionStart = input.selectionEnd = start + emoji.length;
    input.focus();
    input.dispatchEvent(new Event('input'));
}

// Templates r√°pidos
function applyTemplate(tipo) {
    const tituloInput = document.getElementById('{{ form.titulo.id_for_label }}');
    const mensagemInput = document.getElementById('{{ form.mensagem.id_for_label }}');
    const tipoSelect = document.getElementById('{{ form.tipo.id_for_label }}');

    const templates = {
        'rodada': { tipo: 'nova_rodada', titulo: 'üÜï Nova Rodada Dispon√≠vel!', mensagem: '‚öΩ Uma nova rodada est√° aberta para palpites! Entre agora e fa√ßa seus palpites antes que o prazo termine. Boa sorte! üçÄ' },
        'lembrete': { tipo: 'lembrete_prazo', titulo: '‚è∞ √öltimo prazo para palpites!', mensagem: 'üö® Faltam poucas horas para o prazo encerrar! N√£o fique de fora, garanta seus pontos! üí™' },
        'resultados': { tipo: 'resultados', titulo: 'üìä Resultados da Rodada!', mensagem: 'üèÜ Os resultados foram publicados! Confira como foi sua rodada e veja a classifica√ß√£o atualizada. üìà' },
        'ranking': { tipo: 'ranking', titulo: 'üèÜ Ranking Atualizado!', mensagem: 'üìà A classifica√ß√£o geral foi atualizada! Confira sua posi√ß√£o e veja quem subiu ou desceu. üî•' },
        'anuncio': { tipo: 'sistema', titulo: 'üì¢ Novidade no FutAmigo!', mensagem: 'üöÄ Temos novidades para voc√™! Acesse o FutAmigo e confira as atualiza√ß√µes. ‚öΩ' },
        'manutencao': { tipo: 'sistema', titulo: 'üîß Manuten√ß√£o Programada', mensagem: '‚ö†Ô∏è O FutAmigo passar√° por uma breve manuten√ß√£o para melhorias. Voltaremos em breve! üôè' }
    };

    const t = templates[tipo];
    if (t) {
        tituloInput.value = t.titulo;
        mensagemInput.value = t.mensagem;
        tipoSelect.value = t.tipo;
        tituloInput.dispatchEvent(new Event('input'));
        mensagemInput.dispatchEvent(new Event('input'));
    }
}
</script>
{% endblock %}